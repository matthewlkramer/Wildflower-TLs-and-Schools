import type { TableColumnMeta, RowActionId, TableToggleSpec } from './detail-types';
import { COLUMN_TEMPLATES as TABLE_COLUMNS } from './schema/registry';
import { cols } from './schema/helpers';
// Presets are now self-contained; no external column/action bundles

export type TablePreset = {
  readSource?: { schema?: string; table: string; fkColumn: string };
  writeDefaults?: { schema?: string; table: string; pk?: string; pkColumn?: string };
  columns?: readonly string[] | readonly TableColumnMeta[];
  rowActions?: readonly RowActionId[];
  tableActions?: readonly string[];
  tableActionLabels?: readonly string[];
  toggles?: readonly TableToggleSpec[];
};

// Column templates now come from the Domain Registry

export const TABLE_PRESETS = {
  // Charter module presets
  charterAuthorizerActions: {
    readSource: { table: 'charter_authorization_actions', fkColumn: 'charter_id' },
    writeDefaults: { table: 'charter_authorization_actions', pkColumn: 'id' },
    columns: [
      { field: 'action', label: 'Action', type: 'string' },
      { field: 'action_date', label: 'Action Date', type: 'date' },
      { field: 'authorized_after_action', label: 'Authorized After?', type: 'boolean' },
    ] as const,
    rowActions: ['view_in_modal'] as const,
  },


  charterEducators: {
    readSource: { table: 'details_associations', fkColumn: 'charter_id' },
    writeDefaults: { table: 'people_roles_associations', pkColumn: 'id' },
    columns: [ { field: 'school_name', label: 'School', type: 'string' , update: 'newOnly'}, ...cols('educators') ] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'email', 'add_note','add_task','archive'] as const,
    toggles: [ { id: 'active', label: 'Active only', expr: { eq: { column: 'is_active', value: true } }, defaultOn: true } ],
  },



  charterSchools: {
    readSource: { table: 'details_associations', fkColumn: 'charter_id' },
    writeDefaults: { table: 'people_roles_associations', pkColumn: 'id' },
    columns: [ { field: 'full_name', label: 'Educator', type: 'string', update: 'newOnly' }, ...cols('schools') ] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'add_note','add_task','archive'] as const,
    toggles: [ { id: 'active', label: 'Active only', expr: { eq: { column: 'is_active', value: true } }, defaultOn: true } ],
  },


  charterGmails: {
    readSource: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', fkColumn: 'charter_id' },
    writeDefaults: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.gmails] as const,
    rowActions: ['view_in_modal', 'toggle_private_public', 'email'] as const,
  },



  charterCalendarEvents: {
    readSource: { schema: 'gsync', table: 'g_events_with_people_ids_mv', fkColumn: 'charter_id' },
    writeDefaults: { schema: 'gsync', table: 'g_events_with_people_ids_mv', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.calendarEvents] as const,
    rowActions: ['view_in_modal', 'toggle_private_public'] as const,
  },



  charterActionSteps: {
    readSource: { table: 'action_steps', fkColumn: 'charter_id' },
    writeDefaults: { table: 'action_steps', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.actionSteps] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_complete', 'archive'] as const,
    tableActions: ['addActionStep'] as const,
    tableActionLabels: ['Add Action Step'] as const,
  },



  charterNotes: {
    readSource: { table: 'notes', fkColumn: 'charter_id' },
    writeDefaults: { table: 'notes', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.notes] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_private_public', 'archive'] as const,
    tableActions: ['addNote'] as const,
    tableActionLabels: ['Add Note'] as const,
  },

  // Charter recurring tables


  charterGrants: {
    readSource: { table: 'grants', fkColumn: 'charter_id' },
    writeDefaults: { table: 'grants', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.grants] as const,
    rowActions: ['inline_edit', 'view_in_modal','archive'] as const,
    tableActions: ['addGrant'] as const,
    tableActionLabels: ['Add Grant'] as const,
  },


  charterLoans: {
    readSource: { table: 'loans', fkColumn: 'charter_id' },
    writeDefaults: { table: 'loans', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.loans] as const,
    rowActions: ['view_in_modal'] as const,
    tableActionLabels: [] as const,
  },


  charterGovernanceDocs: {
    readSource: { table: 'governance_docs', fkColumn: 'charter_id' },
    writeDefaults: { table: 'governance_docs', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.governance_docs] as const,
    rowActions: ['view_in_modal', 'archive'] as const,
    tableActions: ['addGovDoc'] as const,
    tableActionLabels: ['Add Document'] as const,
  },



  charterNineNineties: {
    readSource: { table: 'nine_nineties', fkColumn: 'charter_id' },
    writeDefaults: { table: 'nine_nineties', pkColumn: 'id' },
    columns: cols('nine_nineties') as const,
    rowActions: ['view_in_modal', 'archive'] as const,
    tableActions: ['addNineNinety'] as const,
    tableActionLabels: ['Add 990'] as const,
  },

  charterReports: {
    readSource: { table: 'school_reports_and_submissions', fkColumn: 'charter_id' },
    writeDefaults: { table: 'school_reports_and_submissions', pkColumn: 'id' },
    columns: [
      { field: 'school_year', label: 'School Year', type: 'string', lookup: { table: 'ref_school_years', valueColumn: 'value', labelColumn: 'value' } },
      { field: 'report_type', label: 'Report Type', type: 'string' },
      { field: 'attachment', label: 'Attachment', type: 'attachment' },
    ] as const,
    rowActions: ['view_in_modal','archive'] as const,
    tableActions: ['addReport'] as const,
    tableActionLabels: ['Add Report'] as const,
  },

  charterAnnualData: {
    readSource: { table: 'annual_assessment_and_metrics_data', fkColumn: 'charter_id' },
    writeDefaults: { table: 'annual_assessment_and_metrics_data', pkColumn: 'id' },
    columns: [
      { field: 'school_year', label: 'School Year', type: 'string', lookup: { table: 'ref_school_years', valueColumn: 'value', labelColumn: 'value' } },
      { field: 'assessment_or_metric', label: 'Assessment/Metric', type: 'string' , lookup: { table: 'ref_assessments_and_metrics', valueColumn: 'value', labelColumn: 'value' }  },
      { field: 'metric_data', label: 'Value', type: 'string' },
    ] as const,
    rowActions: ['view_in_modal','archive'] as const,
    tableActions: ['addData'] as const,
    tableActionLabels: ['Add Data'] as const,
  },

  charterEnrollment: {
    readSource: { table: 'annual_enrollment_and_demographics', fkColumn: 'charter_id' },
    writeDefaults: { table: 'annual_enrollment_and_demographics', pkColumn: 'id' },
    columns: cols('enrollment') as const,
    rowActions: ['inline_edit', 'view_in_modal','archive'] as const,
    tableActions: ['addEnrollmentData'] as const,
    tableActionLabels: ['Add Data'] as const,
  },

  charterGuideAssignments: {
    readSource: { table: 'guide_assignments', fkColumn: 'charter_id' },
    writeDefaults: { table: 'guide_assignments', pkColumn: 'id' },
    columns: cols('guideAssignments') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'archive'] as const,
    tableActions: ['addGuideLink', 'addNewGuide'] as const,
    tableActionLabels: ['Assign Guide', 'Add Guide & Assignment'] as const,
    toggles: [ { id: 'active', label: 'Active only', expr: { eq: { column: 'is_active', value: true } }, defaultOn: true } ],
  },

  charterBoardMembers: {
    readSource: { table: 'people', fkColumn: 'charter_id' },
    writeDefaults: { table: 'people', pkColumn: 'id' },
    columns: cols('boardMembers') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'email','archive'] as const,
    tableActions: ['addPersonToBoard','addNewPersonToBoard'] as const,
    tableActionLabels: ['Add Person to Board','Add New Person to Board'] as const,
  },
  // Educator module presets
  educatorEmails: {
    readSource: { table: 'email_addresses', fkColumn: 'people_id' },
    writeDefaults: { table: 'email_addresses', pkColumn: 'id' },
    columns: [
      { field: 'email_address', label: 'Email Address', type: 'string' },
      { field: 'category', label: 'Category', type: 'enum', enumName: 'email_address_categories' },
      { field: 'is_primary', label: 'Primary?', type: 'boolean' },
      { field: 'is_valid', label: 'Valid?', type: 'boolean' },
    ] as const,
    rowActions: ['inline_edit', 'make_primary', 'toggle_valid', 'email','archive'] as const,
    tableActions: ['addEmail'] as const,
    tableActionLabels: ['Add Email'] as const,
  },

  educatorSchools: {
    readSource: { table: 'details_associations', fkColumn: 'people_id' },
    writeDefaults: { table: 'people_roles_associations', pkColumn: 'id' },
    columns: cols('schools') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'archive'] as const,
    tableActions: ['addStintAtSchool', 'addSchoolAndStint'] as const,
    tableActionLabels: ['Add Role at School', 'Add School & Role'] as const,
    toggles: [ { id: 'active', label: 'Active only', expr: { eq: { column: 'is_active', value: true } }, defaultOn: true } ],
  },

  educatorMontessoriCerts: {
    readSource: { table: 'montessori_certs', fkColumn: 'people_id' },
    writeDefaults: { table: 'montessori_certs', pkColumn: 'id' },
    columns: [
      { field: 'year', label: 'Year', type: 'string' },
      { field: 'association', label: 'Association', type: 'enum', enumName: 'montessori_associations' },
      { field: 'cert_level', label: 'Status', type: 'enum', enumName: 'age_spans_rev' },
      { field: 'cert_completion_status', label: 'Status', type: 'enum', enumName: 'certification_completion_status' },
      { field: 'macte_accredited', label: 'MACTE?', type: 'boolean' },
      { field: 'trainer', label: 'Trainer', type: 'string' },
      { field: 'training_center', label: 'Training Center', type: 'string' },
      { field: 'admin_credential', label: 'Admin Credential?', type: 'boolean' },
      { field: 'assistant_training', label: 'Assistant Training?', type: 'boolean' },
    ] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'archive'] as const,
    tableActions: ['addTraining'] as const,
    tableActionLabels: ['Add Certification'] as const,
  },

  educatorEvents: {
    readSource: { table: 'event_attendance', fkColumn: 'people_id' },
    writeDefaults: { table: 'event_attendance', pkColumn: 'id' },
    columns: [
      { field: 'event_name', label: 'Event Name', type: 'string', lookup: { table: 'event_list', valueColumn: 'event_name', labelColumn: 'event_name' } },
      { field: 'event_date', label: 'Event Date', type: 'date' },
      { field: 'attended_event', label: 'Attended?', type: 'boolean' },
      { field: 'registration_date', label: 'Registration Date', type: 'date' },
    ] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'archive'] as const,
    tableActions: ['addEvent'] as const,
    tableActionLabels: ['Add Attendance at Event'] as const,
  },

  educatorActionSteps: {
    readSource: { table: 'action_steps', fkColumn: 'people_id' },
    writeDefaults: { table: 'action_steps', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.actionSteps] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_complete', 'archive'] as const,
    tableActions: ['addActionStep'] as const,
    tableActionLabels: ['Add Action Step'] as const,
    toggles: [ { id: 'incomplete', label: 'Incomplete only', expr: { eq: { column: 'item_status', value: 'Incomplete' } }, defaultOn: true } ],
  },

  educatorNotes: {
    readSource: { table: 'notes', fkColumn: 'people_id' },
    writeDefaults: { table: 'notes', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.notes] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_private_public', 'archive'] as const,
    tableActions: ['addNote'] as const,
    tableActionLabels: ['Add Note'] as const,
  },

  educatorGmails: {
    readSource: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', fkColumn: 'people_id' },
    writeDefaults: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', pkColumn: 'id' },
    columns: cols('gmails') as const,
    rowActions: ['view_in_modal', 'toggle_private_public','email'] as const,
  },

  educatorCalendarEvents: {
    readSource: { schema: 'gsync', table: 'g_events_with_people_ids_mv', fkColumn: 'people_id' },
    writeDefaults: { schema: 'gsync', table: 'g_events_with_people_ids_mv', pkColumn: 'id' },
    columns: cols('calendarEvents') as const,
    rowActions: ['view_in_modal', 'toggle_private_public'] as const,
  },

  // School module presets
  schoolNotes: {
    readSource: { table: 'notes', fkColumn: 'school_id' },
    writeDefaults: { table: 'notes', pkColumn: 'id' },
    columns: cols('notes') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_private_public','archive'] as const,
    tableActions: ['addNote'] as const,
    tableActionLabels: ['Add Note'] as const,
  },

  schoolGmails: {
    readSource: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', fkColumn: 'school_id' },
    writeDefaults: { schema: 'gsync', table: 'g_emails_with_people_ids_mv', pkColumn: 'id' },
    columns: cols('gmails') as const,
    rowActions: ['view_in_modal', 'toggle_private_public','email'] as const,
  },

  schoolCalendarEvents: {
    readSource: { schema: 'gsync', table: 'g_events_with_people_ids_mv', fkColumn: 'school_id' },
    writeDefaults: { schema: 'gsync', table: 'g_events_with_people_ids_mv', pkColumn: 'id' },
    columns: cols('calendarEvents') as const,
    rowActions: ['view_in_modal', 'toggle_private_public'] as const,
  },

  schoolEducators: {
    readSource: { table: 'details_associations', fkColumn: 'school_id' },
    writeDefaults: { table: 'people_roles_associations', pkColumn: 'id' },
    columns: cols('educators') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'email','archive'] as const,
    tableActions: ['addExistingEducatorToSchool','addNewEducatorToSchool'] as const,
    tableActionLabels: ['Add Existing Educator','Add New Educator'] as const,
    toggles: [ { id: 'active', label: 'Active only', expr: { eq: { column: 'is_active', value: true } }, defaultOn: true } ],
  },

  // School recurring tables
  schoolGrants: {
    readSource: { table: 'grants', fkColumn: 'school_id' },
    writeDefaults: { table: 'grants', pkColumn: 'id' },
    columns: cols('grants') as const,
    rowActions: ['inline_edit', 'view_in_modal', 'archive'] as const,
    tableActions: ['addGrant'] as const,
    tableActionLabels: ['Add Grant'] as const,
  },

  schoolLoans: {
    readSource: { table: 'loans', fkColumn: 'school_id' },
    writeDefaults: { table: 'loans', pkColumn: 'id' },
    columns: cols('loans') as const,
    rowActions: ['view_in_modal'] as const,
    tableActionLabels: [] as const,
  },

  schoolLocations: {
    readSource: { table: 'locations', fkColumn: 'school_id' },
    writeDefaults: { table: 'locations', pkColumn: 'id' },
    columns: [
      { field: 'address', label: 'Address', type: 'string', multiline: true },
      { field: 'start_date', label: 'Start Date', type: 'date' },
      { field: 'end_date', label: 'End Date', type: 'date' },
      { field: 'current_mail_address', label: 'Current Mail Address?', type: 'boolean' },
      { field: 'current_physical_address', label: 'Current Physical Address?', type: 'boolean' },
    ] as const,
    rowActions: ['inline_edit','view_in_modal', 'end_occupancy', 'archive'] as const,
    tableActions: ['addLocation'] as const,
    tableActionLabels: ['Add Location'] as const,
    toggles: [ { id: 'current', label: 'Current only', expr: { or: [ { eq: { column: 'current_physical_address', value: true } }, { eq: { column: 'current_mail_address', value: true } } ] }, defaultOn: true } ],
  },

  schoolGovernanceDocs: {
    readSource: { table: 'governance_docs', fkColumn: 'school_id' },
    writeDefaults: { table: 'governance_docs', pkColumn: 'id' },
    columns: cols('governance_docs') as const,
    rowActions: ['inline_edit', 'view_in_modal'] as const,
    tableActions: ['addDocument'] as const,
    tableActionLabels: ['Add Document'] as const,
  },

  schoolNineNineties: {
    readSource: { table: 'nine_nineties', fkColumn: 'school_id' },
    writeDefaults: { table: 'nine_nineties', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.nine_nineties] as const,
    rowActions: ['archive'] as const,
    tableActions: ['addNineNinety'] as const,
    tableActionLabels: ['Add 990'] as const,
  },

  schoolEnrollment: {
    readSource: { table: 'annual_enrollment_and_demographics', fkColumn: 'school_id' },
    writeDefaults: { table: 'annual_enrollment_and_demographics', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.enrollment]   as const,
    rowActions: ['inline_edit'] as const,
    tableActions: ['addRecord'] as const,
    tableActionLabels: ['Add Data'] as const,
  },

  schoolGuideAssignments: {
    readSource: { table: 'guide_assignments', fkColumn: 'school_id' },
    writeDefaults: { table: 'guide_assignments', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.guideAssignments] as const,
    rowActions: ['inline_edit','view_in_modal','jump_to_modal','end_stint','archive'] as const,
    tableActions: ['addGuideLink', 'addNewGuide'] as const,
    tableActionLabels: ['Assign Guide', 'Add Guide & Assignment'] as const,
  },

  schoolActionSteps: {
    readSource: { table: 'action_steps', fkColumn: 'school_id' },
    writeDefaults: { table: 'action_steps', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.actionSteps] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'toggle_complete', 'archive'] as const,
    tableActions: ['addActionStep'] as const,
    tableActionLabels: ['Add Action Step'] as const,
    toggles: [ { id: 'incomplete', label: 'Incomplete only', expr: { eq: { column: 'item_status', value: 'Incomplete' } }, defaultOn: true } ],
  },
  // fix this and above
  schoolBoardMembers: {
    readSource: { table: 'people', fkColumn: 'school_id' },
    writeDefaults: { table: 'people', pkColumn: 'id' },
    columns: [...TABLE_COLUMNS.boardMembers] as const,
    rowActions: ['inline_edit', 'view_in_modal', 'jump_to_modal', 'end_stint', 'email','archive'] as const,
    tableActions: ['addPersonToBoard','addNewPersonToBoard'] as const,
    tableActionLabels: ['Add Person to Board','Add New Person to Board'] as const,
  },
} as const;

export type TablePresetId = keyof typeof TABLE_PRESETS;


